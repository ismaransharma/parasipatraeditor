<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Facebook Post Editor</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Hind:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Hind", Arial, sans-serif;
        background: #f4f4f4;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      h1 {
        margin-bottom: 20px;
        color: #333;
      }

      #controls {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      input[type="file"],
      input[type="color"],
      input[type="text"],
      button {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      #previewContainer {
        border: 1px solid #ccc;
        background: #fff;
        padding: 10px;
        margin-bottom: 20px;
        width: 100%;
        max-width: 1250px;
        text-align: center;
      }

      .facebook-frame {
        border: 1px solid #ddd;
        border-radius: 8px;
        width: 1200px;
        height: 630px;
        display: inline-block;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      canvas {
        display: block;
      }

      footer {
        text-align: center;
        padding: 15px;
        background-color: #f8f9fa;
        margin-top: 30px;
        font-size: 14px;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <h1>Facebook Post Editor</h1>

    <div id="controls">
      <input type="file" id="imageUpload" accept="image/*" />
      <input type="text" id="headingText" placeholder="Heading" />
      <input type="color" id="headingColor" value="#0066b3" />
      <input type="text" id="subheadingText" placeholder="Subheading" />
      <input type="color" id="subheadingColor" value="#ffffff" />
      <button id="downloadBtn">Download</button>
    </div>

    <div id="previewContainer">
      <div class="facebook-frame">
        <canvas id="canvas" width="1200" height="630"></canvas>
      </div>
    </div>

    <footer>&copy; 2025 Smaran Sharma. All rights reserved.</footer>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const imageUpload = document.getElementById("imageUpload");
      const headingInput = document.getElementById("headingText");
      const subheadingInput = document.getElementById("subheadingText");
      const headingColorInput = document.getElementById("headingColor");
      const subheadingColorInput = document.getElementById("subheadingColor");

      let bgImage = new Image();
      let logo = new Image();
      logo.src = "icon-192.png";

      function draw(ctx, width, height) {
        ctx.clearRect(0, 0, width, height);
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";

        // Background
        if (bgImage.src) ctx.drawImage(bgImage, 0, 0, width, height);

        // Curve overlay
        const topY = height * 0.5;
        ctx.beginPath();
        ctx.moveTo(0, height);
        ctx.lineTo(width, height);
        ctx.lineTo(width, topY);
        ctx.quadraticCurveTo(width / 2, topY + height * 0.125, 0, topY);
        ctx.closePath();
        ctx.fillStyle = "rgba(0,20,60,0.8)";
        ctx.fill();

        // Dots
        ctx.fillStyle = "rgba(255,255,255,0.2)";
        for (let i = 0; i < 20; i++) {
          const x = Math.random() * width;
          const y = topY + Math.random() * (height - topY);
          ctx.beginPath();
          ctx.arc(x, y, Math.random() * 2 + 1, 0, Math.PI * 2);
          ctx.fill();
        }

        // Logo
        if (logo.complete) {
          const logoAspect = logo.width / logo.height;
          const maxLogoW = width * 0.125;
          const logoH = maxLogoW / logoAspect;
          ctx.drawImage(
            logo,
            width / 2 - maxLogoW / 2,
            topY + height * 0.1,
            maxLogoW,
            logoH
          );
        }

        // Heading with sharper rendering
        ctx.font = `bold ${Math.floor(width * 0.055)}px 'Hind', Arial`;
        ctx.fillStyle = headingColorInput.value;
        ctx.textAlign = "center";
        ctx.textBaseline = "alphabetic";
        ctx.fontSmoothing = "antialiased";
        ctx.fillText(headingInput.value, width / 2, topY + height * 0.26);

        // Subheading
        ctx.font = `bold ${Math.floor(width * 0.04)}px 'Hind', Arial`;
        ctx.fillStyle = subheadingColorInput.value;
        ctx.fontSmoothing = "antialiased";
        ctx.fillText(subheadingInput.value, width / 2, topY + height * 0.35);

        // Website full-width text with white background
        const websiteText =
          "यससम्बन्धी समाचारका लागि www.parasipatra.com मा जानुहोस् ।";
        ctx.font = `bold ${Math.floor(width * 0.02)}px 'Hind', Arial`;
        const textHeight = Math.floor(width * 0.035);
        const padding = 10;
        const textWidth = ctx.measureText(websiteText).width;

        // Draw full-width background
        ctx.fillStyle = "#0066b3";
        ctx.fillRect(
          0,
          height - textHeight - 2 * padding,
          width,
          textHeight + 2 * padding
        );

        // Draw text
        ctx.fillStyle = "#fff";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fontSmoothing = "antialiased";
        ctx.fillText(websiteText, width / 2, height - textHeight / 2 - padding);
      }

      function updateCanvas() {
        draw(ctx, canvas.width, canvas.height);
      }

      // Upload background
      imageUpload.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          bgImage.onload = updateCanvas;
          bgImage.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      });

      // Inputs
      [
        headingInput,
        subheadingInput,
        headingColorInput,
        subheadingColorInput,
      ].forEach((input) => input.addEventListener("input", updateCanvas));

      // Download button
      document.getElementById("downloadBtn").addEventListener("click", () => {
        const hdCanvas = document.createElement("canvas");
        hdCanvas.width = 7680;
        hdCanvas.height = 4320;
        const hdCtx = hdCanvas.getContext("2d");
        hdCtx.imageSmoothingEnabled = true;
        hdCtx.imageSmoothingQuality = "high";

        draw(hdCtx, hdCanvas.width, hdCanvas.height);

        const finalCanvas = document.createElement("canvas");
        finalCanvas.width = 7680;
        finalCanvas.height = 4320;
        const finalCtx = finalCanvas.getContext("2d");
        finalCtx.imageSmoothingEnabled = true;
        finalCtx.imageSmoothingQuality = "high";

        // Progressive downscaling for sharper result
        let tempCanvas = document.createElement("canvas");
        let tempCtx = tempCanvas.getContext("2d");
        tempCanvas.width = hdCanvas.width / 2;
        tempCanvas.height = hdCanvas.height / 2;
        tempCtx.imageSmoothingEnabled = true;
        tempCtx.imageSmoothingQuality = "high";
        tempCtx.drawImage(hdCanvas, 0, 0, tempCanvas.width, tempCanvas.height);

        finalCtx.drawImage(
          tempCanvas,
          0,
          0,
          finalCanvas.width,
          finalCanvas.height
        );

        let quality = 0.98;
        let dataURL = finalCanvas.toDataURL("image/jpeg", quality);

        // Reduce quality progressively if > 2MB
        while (dataURL.length / 1024 > 2000 && quality > 0.5) {
          quality -= 0.05;
          dataURL = finalCanvas.toDataURL("image/jpeg", quality);
        }

        const link = document.createElement("a");
        link.download = "facebook_post_8k.jpg";
        link.href = dataURL;
        link.click();
      });

      // Initial draw
      updateCanvas();
    </script>
  </body>
</html>
