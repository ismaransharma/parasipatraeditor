<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parasi Patra Post Editor</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Hind:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Hind", "Noto Sans Devanagari", Arial, sans-serif;
        background: #f4f4f4;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      h1 {
        margin-bottom: 20px;
        color: #333;
      }

      #controls {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      input[type="file"],
      input[type="color"],
      input[type="text"],
      input[type="number"],
      button {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      #previewContainer {
        border: 1px solid #ccc;
        background: #fff;
        padding: 10px;
        margin-bottom: 20px;
        width: 100%;
        max-width: 1250px;
        text-align: center;
      }

      .facebook-frame {
        border: 1px solid #ddd;
        border-radius: 8px;
        width: 1200px;
        height: 630px;
        display: inline-block;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      canvas {
        display: block;
      }

      footer {
        text-align: center;
        padding: 15px;
        background-color: #f8f9fa;
        margin-top: 30px;
        font-size: 14px;
        width: 100%;
      }

      /* Loading overlay styles */
      #loadingOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #0066b3;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light w-100">
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Editor</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="headingOne.html">Editor 2</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="pdfToJpg.html">Pdf To Jpg</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="nepse.html">NEPSE</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <h1>Parasi Patra Post Editor</h1>

    <div id="controls">
      <input type="file" id="imageUpload" accept="image/*" />
      <input type="text" id="headingText" placeholder="Heading" />
      <input type="number" id="headingFontSize" min="10" max="200" value="40" />
      <input type="color" id="headingColor" value="#0066b3" />
      <input type="text" id="subheadingText" placeholder="Subheading" />
      <input
        type="number"
        id="subheadingFontSize"
        min="10"
        max="150"
        value="22"
      />
      <input type="color" id="subheadingColor" value="#ffffff" />
      <button id="downloadBtn">Download</button>
    </div>

    <div id="previewContainer">
      <div class="facebook-frame">
        <canvas id="canvas" width="1200" height="630"></canvas>
      </div>
    </div>

    <div id="loadingOverlay">
      <div class="spinner"></div>
    </div>

    <footer>&copy; 2025 Smaran Sharma. All rights reserved.</footer>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const loadingOverlay = document.getElementById("loadingOverlay");

      const imageUpload = document.getElementById("imageUpload");
      const headingInput = document.getElementById("headingText");
      const subheadingInput = document.getElementById("subheadingText");
      const headingColorInput = document.getElementById("headingColor");
      const subheadingColorInput = document.getElementById("subheadingColor");
      const headingFontInput = document.getElementById("headingFontSize");
      const subheadingFontInput = document.getElementById("subheadingFontSize");

      let bgImage = new Image();
      let logo = new Image();
      logo.src = "icon-192.png";

      // Draw function
      function draw(ctx, width, height, scale = 1) {
        ctx.clearRect(0, 0, width, height);
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";

        // Background
        if (bgImage.src) ctx.drawImage(bgImage, 0, 0, width, height);

        // Curve overlay
        const topY = height * 0.5;
        ctx.beginPath();
        ctx.moveTo(0, height);
        ctx.lineTo(width, height);
        ctx.lineTo(width, topY);
        ctx.quadraticCurveTo(width / 2, topY + height * 0.125, 0, topY);
        ctx.closePath();
        ctx.fillStyle = "rgba(0,20,60,0.8)";
        ctx.fill();

        // Dots
        ctx.fillStyle = "rgba(255,255,255,0.2)";
        for (let i = 0; i < 20; i++) {
          const x = Math.random() * width;
          const y = topY + Math.random() * (height - topY);
          ctx.beginPath();
          ctx.arc(x, y, Math.random() * 2 * scale + 1 * scale, 0, Math.PI * 2);
          ctx.fill();
        }

        // Logo
        if (logo.complete && logo.naturalWidth !== 0) {
          const logoAspect = logo.width / logo.height;
          const maxLogoW = width * 0.125;
          const logoH = maxLogoW / logoAspect;
          ctx.drawImage(
            logo,
            width / 2 - maxLogoW / 2,
            topY + height * 0.08,
            maxLogoW,
            logoH
          );
        }

        // Heading
        const headingHeight = drawWrappedText(
          ctx,
          headingInput.value,
          width / 2,
          topY + height * 0.2,
          parseInt(headingFontInput.value) * scale,
          headingColorInput.value,
          width * 0.9
        );

        // Subheading below heading
        drawWrappedText(
          ctx,
          subheadingInput.value,
          width / 2,
          topY + height * 0.2 + headingHeight + 10 * scale,
          parseInt(subheadingFontInput.value) * scale,
          subheadingColorInput.value,
          width * 0.85
        );

        // Website text
        const websiteText =
          "यससम्बन्धी समाचारका लागि www.parasipatra.com मा जानुहोस् ।";
        const barHeight = height * 0.07; // 7% of canvas height
        const padding = barHeight * 0.2; // 20% padding inside bar
        const websiteFontSize = barHeight - 2 * padding;

        // Draw blue bar
        ctx.fillStyle = "#0066b3";
        ctx.fillRect(0, height - barHeight, width, barHeight);

        // Draw text centered in bar
        ctx.fillStyle = "#fff";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.font = `bold ${websiteFontSize}px 'Noto Sans Devanagari', 'Hind', Arial`;
        ctx.fillText(websiteText, width / 2, height - barHeight / 2);
      }

      // Wrapped text
      function drawWrappedText(ctx, text, x, y, fontSize, color, maxWidth) {
        const words = text.split(/(\s+)/);
        let line = "";
        const lineHeight = fontSize * 1.3;
        let curY = y;
        ctx.font = `bold ${fontSize}px 'Noto Sans Devanagari', 'Hind', Arial`;
        ctx.fillStyle = color;
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.shadowBlur = 4;

        for (let n = 0; n < words.length; n++) {
          const testLine = line + words[n];
          const metrics = ctx.measureText(testLine);
          if (metrics.width > maxWidth && n > 0) {
            ctx.fillText(line, x, curY);
            line = words[n];
            curY += lineHeight;
          } else {
            line = testLine;
          }
        }
        ctx.fillText(line, x, curY);
        ctx.shadowBlur = 0;
        return curY + lineHeight - y;
      }

      // Update canvas
      function updateCanvas() {
        draw(ctx, canvas.width, canvas.height);
      }

      // Upload background
      imageUpload.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          bgImage.onload = updateCanvas;
          bgImage.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      });

      // Inputs
      [
        headingInput,
        subheadingInput,
        headingColorInput,
        subheadingColorInput,
        headingFontInput,
        subheadingFontInput,
      ].forEach((input) => input.addEventListener("input", updateCanvas));

      // Download
      document.getElementById("downloadBtn").addEventListener("click", () => {
        // Show loading overlay
        loadingOverlay.style.display = "flex";

        const hdCanvas = document.createElement("canvas");
        hdCanvas.width = 7680;
        hdCanvas.height = 4320;
        const scale = hdCanvas.width / canvas.width;
        const hdCtx = hdCanvas.getContext("2d");
        hdCtx.imageSmoothingEnabled = true;
        hdCtx.imageSmoothingQuality = "high";

        // Draw with scaling
        const tempBg = new Image();
        if (bgImage.src) {
          tempBg.onload = () => {
            draw(hdCtx, hdCanvas.width, hdCanvas.height, scale);
            downloadCanvas(hdCanvas);
            // Hide loading overlay after download
            loadingOverlay.style.display = "none";
          };
          tempBg.src = bgImage.src;
        } else {
          draw(hdCtx, hdCanvas.width, hdCanvas.height, scale);
          downloadCanvas(hdCanvas);
          // Hide loading overlay after download
          loadingOverlay.style.display = "none";
        }

        function downloadCanvas(c) {
          let quality = 0.98;
          let dataURL = c.toDataURL("image/jpeg", quality);
          while (dataURL.length / 1024 > 2000 && quality > 0.5) {
            quality -= 0.05;
            dataURL = c.toDataURL("image/jpeg", quality);
          }
          const link = document.createElement("a");
          link.download = "facebook_post_8k.jpg";
          link.href = dataURL;
          link.click();
        }
      });

      updateCanvas();
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha1/js/bootstrap.min.js"
      integrity="sha512-eHx4nbBTkIr2i0m9SANm/cczPESd0DUEcfl84JpIuutE6oDxPhXvskMR08Wmvmfx5wUpVjlWdi82G5YLvqqJdA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </body>
</html>
